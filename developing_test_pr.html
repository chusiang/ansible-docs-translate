

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>幫助測試PR &mdash; ansible中文權威指南 1.0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ansible中文權威指南 1.0.1 documentation" href="index.html"/>
        <link rel="up" title="開發者須知" href="developing.html"/>
        <link rel="next" title="Ansible Tower" href="tower.html"/>
        <link rel="prev" title="Developing Plugins" href="developing_plugins.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> ansible中文權威指南
          

          
          </a>

          
            
            
              <div class="version">
                1.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">總體介紹</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">快速學習視訊</a></li>
<li class="toctree-l1"><a class="reference internal" href="playbooks.html">Playbooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="playbooks_special_topics.html">Playbooks: Special Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">模組相關</a></li>
<li class="toctree-l1"><a class="reference internal" href="guides.html">詳細指南</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="developing.html">開發者須知</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="developing_api.html">Python API</a></li>
<li class="toctree-l2"><a class="reference internal" href="developing_inventory.html">開發動態的Inventory資料來源</a></li>
<li class="toctree-l2"><a class="reference internal" href="developing_modules.html">Developing Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="developing_plugins.html">Developing Plugins</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">幫助測試PR</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">開始測試</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">使用開發環境</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">找到對應分支並測試</a></li>
<li class="toctree-l3"><a class="reference internal" href="#for-those-about-to-test-we-salute-you">For Those About To Test, We Salute You</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tower.html">Ansible Tower</a></li>
<li class="toctree-l1"><a class="reference internal" href="community.html">Ansible使用者</a></li>
<li class="toctree-l1"><a class="reference internal" href="community.html#id6">對當前和未來的開發人員</a></li>
<li class="toctree-l1"><a class="reference internal" href="community.html#id9">其它主題</a></li>
<li class="toctree-l1"><a class="reference internal" href="galaxy.html">Ansible Galaxy</a></li>
<li class="toctree-l1"><a class="reference internal" href="test_strategies.html">測試策略</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">常見問題</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">術語表</a></li>
<li class="toctree-l1"><a class="reference internal" href="YAMLSyntax.html">YAML 語法</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">ansible中文權威指南</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
          <li><a href="developing.html">開發者須知</a> &raquo;</li>
      
    <li>幫助測試PR</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/developing_test_pr.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="pr">
<h1>幫助測試PR<a class="headerlink" href="#pr" title="Permalink to this headline">¶</a></h1>
<p>作為一名開發者，最具能展現自我價值的事情就是在github上看討論列表來幫助修復bug。我們通常在解決了bug之後再進行新功能的開發，因此解決bug將是一個非常有價值的事情。</p>
<p>即使你不是一個開發者，幫助測試bug的修復情況以及新功能還是非常有必要的。</p>
<p>這同樣適用於測試新功能以及測試錯誤修正。</p>
<p>通常情況下，編碼工作應當包含測試用例來保證編碼的正確性，但這並不總能照顧到程式碼的方方面面，尤其在各平臺下測試使用者沒有足夠的訪問許可權，或者使用的是API或者web服務。</p>
<p>在這種情況下，在真實的環境下上線測試將會比自動測試更有價值。在任何情況下，都是應該進行一次人工測試。</p>
<p>幸運的是在你充分了解ansible的工作機制的情況下，幫助測試ansible是一件非常簡單的事情。</p>
<div class="section" id="id1">
<h2>開始測試<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>你可以在ansible主分支上切出一個分支來保持和主分支隔離，合併GitHub上的問題，測試，然後在GitHub對這一特定問題做一個回饋。具體方法如下：</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">幫助測試GitHub上那些提交合並請求的程式碼是否存在風險，這些風險可能包括存在錯誤或惡意程式碼。我們建議在虛擬機器上測試，無論是雲，或在本地。有些人喜歡Vagrant，或Docker，這是可以的，但我們並不推薦。 在不同的Linux系統環境下進行測試也是非常有意義的，因為某些功能（諸如APT和yum等包管理工具）專用於這些作業系統。</p>
</div>
<p>當然配置您的測試環境來執行我們的測試套件需要一系列工具。以下軟體是必須的:</p>
<div class="highlight-python"><div class="highlight"><pre>git
python-nosetests (sometimes named python-nose)
python-passlib
python-mock
</pre></div>
</div>
<p>如果你想執行完整的整合測試套件，你還需要安裝以下軟體包:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">svn</span>
<span class="n">hg</span>
<span class="n">python</span><span class="o">-</span><span class="n">pip</span>
<span class="n">gem</span>
</pre></div>
</div>
<p>當準備完以上環境後，您可以從github上拉取Ansible的原程式碼進行測試了:</p>
<div class="highlight-python"><div class="highlight"><pre>git clone https://github.com/ansible/ansible.git --recursive
cd ansible/
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">如果您已經Fork了我們的程式碼，您就可以從你自己程式碼倉庫裡克隆了。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">如果你打算更新你的倉庫作為測試一些相關模組，請使用&#8221;git rebase origin/devel&#8221;，並且使用&#8221;git submodule update&#8221;更新子模組，如不更新，您將使用舊版本的模組。</p>
</div>
</div>
<div class="section" id="id2">
<h2>使用開發環境<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>Ansible原始碼包括一個指令碼，可以讓你直接使用Ansible從原始碼，而無需完全安裝，這對於的Ansible開發者來說十分便利。</p>
<p>使用以下命令進入開發環境，這主要針對的是Linux/Unix的終端測試環境:</p>
<div class="highlight-python"><div class="highlight"><pre>source ./hacking/env-setup
</pre></div>
</div>
<p>該指令碼修改了PYTHONPATH（以及一些其他的東西），這僅僅對於當次shell 會話有效。</p>
<p>如果你想永久使測試環境生效，你可以將其放入開機啟動指令碼中（例如，<cite>.bash_profile</cite>）。</p>
</div>
<div class="section" id="id3">
<h2>找到對應分支並測試<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>接下來，手動合併你想測試的提交請求，並且記錄下源和倉庫的資訊。它會是這個樣子:</p>
<div class="highlight-python"><div class="highlight"><pre>Someuser wants to merge 1 commit into ansible:devel from someuser:feature_branch_name
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">請務必將提交合並請求提交到ansible:devel分支，我們不會接受您提交到其他分支。版本的更新將由我們的工作人員手動進行。</p>
</div>
<p>使用者名稱和分支名是十分重要的，這將顯示在以下命令列中:</p>
<div class="highlight-python"><div class="highlight"><pre>git checkout -b testing_PRXXXX devel
git pull https://github.com/someuser/ansible.git feature_branch_name
</pre></div>
</div>
<p>第一行命令表示在devel分支上新建一個新分支名叫testing_PRXXXX，而XXXX是實際合併請求申請的ID號（例如，1234），並切換到該分支下。第二行命令則表示拉取對應使用者的對應分支的程式碼。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the GitHub user interface shows that the pull request will not merge cleanly, we do not recommend proceeding if you
are not somewhat familiar with git and coding, as you will have to resolve a merge conflict.  This is the responsibility of
the original pull request contributor.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Some users do not create feature branches, which can cause problems when they have multiple, un-related commits in
their version of <cite>devel</cite>. If the source looks like <cite>someuser:devel</cite>, make sure there is only one commit listed on
the pull request.</p>
</div>
</div>
<div class="section" id="for-those-about-to-test-we-salute-you">
<h2>For Those About To Test, We Salute You<a class="headerlink" href="#for-those-about-to-test-we-salute-you" title="Permalink to this headline">¶</a></h2>
<p>At this point, you should be ready to begin testing!</p>
<p>If the PR is a bug-fix pull request, the first things to do are to run the suite of unit and integration tests, to ensure
the pull request does not break current functionality:</p>
<div class="highlight-python"><div class="highlight"><pre># Unit Tests
make tests

# Integration Tests
cd test/integration
make
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Ansible does provide integration tests for cloud-based modules as well, however we do not recommend using them for some users
due to the associated costs from the cloud providers.  As such, typically it&#8217;s better to run specific parts of the integration battery
and skip these tests.</p>
</div>
<p>Integration tests aren&#8217;t the end all beat all - in many cases what is fixed might not <em>HAVE</em> a test, so determining if it works means
checking the functionality of the system and making sure it does what it said it would do.</p>
<p>Pull requests for bug-fixes should reference the bug issue number they are fixing.</p>
<p>We encourage users to provide playbook examples for bugs that show how to reproduce the error, and these playbooks should be used to verify the bugfix does resolve
the issue if available.  You may wish to also do your own review to poke the corners of the change.</p>
<p>Since some reproducers can be quite involved, you might wish to create a testing directory with the issue # as a sub-
directory to keep things organized:</p>
<div class="highlight-python"><div class="highlight"><pre>mkdir -p testing/XXXX # where XXXX is again the issue # for the original issue or PR
cd testing/XXXX
&lt;create files or git clone example playbook repo&gt;
</pre></div>
</div>
<p>While it should go without saying, be sure to read any playbooks before you run them.  VMs help with running untrusted content greatly,
though a playbook could still do something to your computing resources that you&#8217;d rather not like.</p>
<p>Once the files are in place, you can run the provided playbook (if there is one) to test the functionality:</p>
<div class="highlight-python"><div class="highlight"><pre>ansible-playbook -vvv playbook_name.yml
</pre></div>
</div>
<p>If there&#8217;s not a playbook, you may have to copy and paste playbook snippets or run a ad-hoc command that was pasted in.</p>
<p>Our issue template also included sections for &#8220;Expected Output&#8221; and &#8220;Actual Output&#8221;, which should be used to gauge the output
from the provided examples.</p>
<p>If the pull request resolves the issue, please leave a comment on the pull request, showing the following information:</p>
<blockquote>
<div><ul class="simple">
<li>&#8220;Works for me!&#8221;</li>
<li>The output from <cite>ansible &#8211;version</cite>.</li>
</ul>
</div></blockquote>
<p>In some cases, you may wish to share playbook output from the test run as well.</p>
<p>Example!:</p>
<div class="highlight-python"><div class="highlight"><pre>Works for me!  Tested on `Ansible 1.7.1`.  I verified this on CentOS 6.5 and also Ubuntu 14.04.
</pre></div>
</div>
<p>If the PR does not resolve the issue, or if you see any failures from the unit/integration tests, just include that output instead:</p>
<div class="highlight-python"><div class="highlight"><pre>This doesn&#39;t work for me.

When I ran this my toaster started making loud noises!

Output from the toaster looked like this:

   ```
   BLARG
   StrackTrace
   RRRARRGGG
   ```
</pre></div>
</div>
<p>When you are done testing a feature branch, you can remove it with the following command:</p>
<div class="highlight-python"><div class="highlight"><pre>git branch -D someuser-feature_branch_name
</pre></div>
</div>
<p>We understand some users may be inexperienced with git, or other aspects of the above procedure, so feel free to stop by ansible-devel
list for questions and we&#8217;d be happy to help answer them.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tower.html" class="btn btn-neutral float-right" title="Ansible Tower" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="developing_plugins.html" class="btn btn-neutral" title="Developing Plugins" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, www.magedu.com, AUTHORS: 薛定諤的章魚 &amp; guli &amp; 以馬內利 &amp; 黃博文 &amp; coocla &amp; 雲中鶴 &amp; stanley.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>